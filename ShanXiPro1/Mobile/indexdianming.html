<!doctype html>
<html>
<head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title id="titlename"></title>
        <link href="css/style.css" rel="stylesheet">
		<style>

		</style>
    </head>

<body style="background:#dedede;">
       
        <!-- Main content -->
        <main >
            <div class="container-fluid">
			  <div class="container" style="margin:10px auto;text-align:center"><h3 id="cont"></h3></div>
				<div class="container" style="margin-top:10px">
	
				
				<div class="row"> 
				 <div class="col-sm-6">
				    <div class="row">
					  <div class="col-sm-3"></div>
					  <div><canvas id="demo-1" ></canvas></div>
					</div>
					<br />
					<br />
					<br />
					<br />
					<br />
					<div class="row">
					   <div class="col-sm-1"></div>
					   <div id= 'diserr' class="col-sm-9 btn btn-warning btn-lg"><span id="errs"></span></div><br />
					</div>
					<br />
				   <div class="row">
					   <div class="col-sm-1"></div>
					   <div id = "end" class="col-sm-9 btn btn-info btn-lg">结束点名</div><br />
					</div>
					<br />
					<div class="row">
					   <div class="col-sm-1"></div>
					   <div class="col-sm-9 btn btn-info btn-lg">
					   	<p id = "tool"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">当前配置</p>
	                        <div class="dropdown-menu pull-right">
	                           	<a class="dropdown-item" href="GetEvent.html">请假设置</a>
				                <a class="dropdown-item" href="GetEvent.html">外出设置</a>
	                        </div>
			             
					   </div>
					  
					</div>
                    
					<br />
					<br />
					<div class="row">
					   <div class="col-sm-1"></div>
					   <div class="col-sm-4 btn btn-primary-outline btn-lg">场所:生产车间</div>
					   <div class="col-sm-1"></div>
					   <div class="col-sm-4 btn btn-primary-outline btn-lg">值班干警:张辉</div><br />
					</div>
				 </div>
				 <div class="col-sm-2"></div>
				 <div class="col-sm-4">
				 <div><canvas id="demo-2" ></canvas></div>
				 <div><canvas id="demo-3" ></canvas></div>
				 <div><canvas id="demo-4" ></canvas></div>
				 </div>			
				</div>
				</div>
			</div>
        </main>


<script src="js/lib/jquery.min.js"></script>
<script src="js/lib/waterbubble.js"></script>
<script src="js/lib/bootstrap.min.js"></script>
<script>
$(document).ready(function(){
    var area = window.localStorage.getItem("OperPerson");
    var op = window.localStorage.getItem("OPER");
    var work =  window.localStorage.getItem("OPERSTATE");
    var jsss = JSON.parse(area);
    $("#titlename").text(""+jsss.areaname+op);
    $("#cont").text(""+jsss.areaname+op);
	var allpeo = "";
	$.ajax({  
	   type : "get",  //提交方式  
	   url  : "http://127.0.0.1:3000/dianming/prison/view?area="+jsss.areaid+"&workstate="+work+"&time="+new Date().getTime(),//路径  
	   success : function(result){//返回数据根据结果进行相应的处理  
		  console.log("主页返回时速局 "+result);
			 
			 var all = result.all;
			 var real =result.real;
			 var getday =result.getday;
			 var getout =result.getout;
			 var errp = result.err;
			
			 allpeo = all;
			 $("#all").text("总人数:"+all);
			 $("#real").text("应到:"+real);
			 $("#getday").text("请假:"+getday);
			 $("#getout").text("外出:"+getout);
			 $("#errs").text("异常:"+errp);
			 
			 $('#demo-1').waterbubble({txt: '总数:'+all,data:1,});
			 $('#demo-2').waterbubble({waterColor: 'rgb(255,255,0)',txt: '实到'+real,data:real/all});
			 $('#demo-3').waterbubble({txt: '请假:'+getday,data:getday/all});
			 $('#demo-4').waterbubble({txt: '外派:'+getout,data:getout/all});

		 }

	 });
    var inter = setInterval(function(){
             console.log("定时点名");
             $.ajax({  
		           type : "get",  //提交方式  
		           url  : "http://127.0.0.1:3000/dianming/prison/realview?area="+jsss.areaid+"&time="+new Date().getTime(),//路径  
		           success : function(result){//返回数据根据结果进行相应的处理  
				      console.log("主页返回时速局 "+result);
		                 
                        
		                 var real =result[0];
		                 var errp = result[1];
		                
		                 
		                 $("#real").text("应到:"+real);
		                 $("#errs").text("异常:"+errp);
		                 
						 $('#demo-2').waterbubble({waterColor: 'rgb(255,255,0)',txt: '实到'+real,data:real/allpeo});
         			 }

   				 });
         
},3000);
/*$('#demo-1').waterbubble({txt: '总数:90',data: 0.9,});
$('#demo-2').waterbubble({waterColor: 'rgb(255,255,0)',txt: '实到'});
$('#demo-3').waterbubble({txt: '请假:10',data:0.1});
$('#demo-4').waterbubble({txt: '外派:5',data:0.05});*/
$('#end').click(function(){

    console.log("停止点名");
    window.localStorage.removeItem("TIME");
    window.localStorage.setItem("TIME",new Date().Format("yyyy-MM-dd hh:mm:ss").toString());
    clearInterval(inter);
    
    window.history.go(-1)
  });

$('#diserr').click(function(){

 
   //window.open("err.html");
   window.location.href = "err.html";

});
$('#demo-2').click(function(){

window.localStorage.removeItem("getItemSon");
window.localStorage.setItem("getItemSon","0");
//window.open("GetPerson.html");
window.location.href = "GetEvent.html"

});

$('#demo-3').click(function(){


window.localStorage.removeItem("getItemSon");
window.localStorage.setItem("getItemSon","1");
//window.open("GetPerson.html");
window.location.href = "GetEvent.html"

});

$('#demo-4').click(function(){

window.localStorage.removeItem("getItemSon");
window.localStorage.setItem("getItemSon","2");
//window.open("GetPerson.html");
window.location.href = "GetEvent.html"
});

})
    Date.prototype.Format = function (fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "h+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
      }
</script>
</body>
</html>
